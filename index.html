<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>小说目录</title>
<style>
    body { font-family: Arial; padding: 20px; }
    .novel-title { font-size: 22px; margin-top: 20px; cursor: pointer; color: #3366cc; }
    .chapter-list { margin-left: 20px; display: none; }
    a { display: block; margin: 5px 0; font-size: 18px; }
</style>
</head>
<body>

<h2>小说列表</h2>
<div id="toc">正在载入 novels.opml...</div>

<script>
fetch("novels.opml")
    .then(r => r.text())
    .then(text => {
        const xml = new DOMParser().parseFromString(text, "text/xml");
        const novels = xml.querySelectorAll('outline[type="novel"]');

        let html = "";

        novels.forEach(novel => {
            const name = novel.getAttribute("text");
            const chapters = novel.querySelectorAll('outline[type="file"]');

            const novelId = "novel_" + name;

            html += `
                <div class="novel-title" onclick="toggle('${novelId}')">${name}</div>
                <div id="${novelId}" class="chapter-list">
            `;

            chapters.forEach(ch => {
                const title = ch.getAttribute("text");
                const url = ch.getAttribute("url");
                html += `<a href="reader.html?file=${encodeURIComponent(url)}">${title}</a>`;
            });

            html += `</div>`;
        });

        document.getElementById("toc").innerHTML = html;
    })
    .catch(err => {
        document.getElementById("toc").innerText = "无法读取 novels.opml";
        console.error(err);
    });

function toggle(id) {
    const div = document.getElementById(id);
    div.style.display = (div.style.display === "block" ? "none" : "block");
}
</script>

</body>
</html>
